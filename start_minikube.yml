- name: "start minikube"
  command: "minikube start --memory=4096 --cpus=2 --disk-size=40g --vm-driver=virtualbox --bootstrapper kubeadm --kubernetes-version=1.17.4"
  register: "output"

- debug: var=output.stdout_lines

- name: "enable k8 engress"
  command: "minikube addons enable ingress"
  register: "output"

- debug: var=output.stdout_lines

# workaround for Minikube issue 1568. The workaround lets pods deployed on Minikube reach themselves on the network.
# minikube ssh sudo ip link set docker0 promisc on
- name: "workaround for Minikube issue 1568"
  command: "minikube ssh sudo ip link set docker0 promisc on"
  register: "output"

- debug: var=output.stdout_lines

- name: create namespace
  k8s:
    name: my-namespace
    api_version: v1
    kind: Namespace
    state: present